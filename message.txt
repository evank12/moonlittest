local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local IsMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

local Lighting = game:GetService("Lighting")

local Settings = {
    SpeedEnabled = false,
    SpeedValue = 32,
    FlyEnabled = false,
    FlySpeed = 50,
    AutoHarvestEnabled = false,
    HarvestRadius = 30,
    NoClipEnabled = false,
    InfJumpEnabled = false,
    JumpPower = 50,
    AntiAFKEnabled = false,
    AutoCollectEnabled = false,
    AutoTPSeedsEnabled = false,
    SeedCheckInterval = 3,
    PlantESPEnabled = false,
    PlantChamsEnabled = false,
    PlayerESPEnabled = false,
    PlayerChamsEnabled = false,
    GalaxySkyEnabled = false,
    FullbrightEnabled = false,
}

local ESP_TAG = "GH_Highlight"

local function clearTagged(tag)
    for _, desc in pairs(workspace:GetDescendants()) do
        if desc:IsA("Highlight") and desc.Name == tag then
            desc:Destroy()
        end
    end
    for _, plr in pairs(Players:GetPlayers()) do
        if plr.Character then
            for _, desc in pairs(plr.Character:GetDescendants()) do
                if desc:IsA("Highlight") and desc.Name == tag then
                    desc:Destroy()
                end
            end
        end
    end
end

local radiusCircle = Instance.new("Part")
radiusCircle.Name = "GH_RadiusCircle"
radiusCircle.Anchored = true
radiusCircle.CanCollide = false
radiusCircle.Shape = Enum.PartType.Cylinder
radiusCircle.Material = Enum.Material.Neon
radiusCircle.Color = Color3.fromRGB(76, 175, 80)
radiusCircle.Transparency = 0.85
radiusCircle.Size = Vector3.new(0.15, Settings.HarvestRadius * 2, Settings.HarvestRadius * 2)
radiusCircle.CFrame = CFrame.new(0, -500, 0)
radiusCircle.Parent = workspace

local radiusRing = Instance.new("Part")
radiusRing.Name = "GH_RadiusRing"
radiusRing.Anchored = true
radiusRing.CanCollide = false
radiusRing.Shape = Enum.PartType.Cylinder
radiusRing.Material = Enum.Material.Neon
radiusRing.Color = Color3.fromRGB(76, 175, 80)
radiusRing.Transparency = 0.4
radiusRing.Size = Vector3.new(0.2, Settings.HarvestRadius * 2 + 1, Settings.HarvestRadius * 2 + 1)
radiusRing.CFrame = CFrame.new(0, -500, 0)
radiusRing.Parent = workspace

local function updateRadiusSize()
    local d = Settings.HarvestRadius * 2
    radiusCircle.Size = Vector3.new(0.15, d, d)
    radiusRing.Size = Vector3.new(0.2, d + 1, d + 1)
end

for _, g in pairs(CoreGui:GetChildren()) do
    if g.Name == "GardenESP" then g:Destroy() end
end
for _, g in pairs(CoreGui:GetChildren()) do
    if g.Name == "GardenHorizonsUI" then g:Destroy() end
end
for _, g in pairs(PlayerGui:GetChildren()) do
    if g.Name == "GardenHorizonsUI" then g:Destroy() end
end

local GUI = Instance.new("ScreenGui")
GUI.Name = "GardenHorizonsUI"
GUI.ResetOnSpawn = false
GUI.IgnoreGuiInset = true
pcall(function() GUI.Parent = CoreGui end)
if not GUI.Parent then GUI.Parent = PlayerGui end

local Theme = {
    Bg = Color3.fromRGB(14, 18, 14),
    Card = Color3.fromRGB(24, 30, 24),
    CardHover = Color3.fromRGB(34, 42, 34),
    TabBg = Color3.fromRGB(18, 22, 18),
    TabActive = Color3.fromRGB(76, 175, 80),
    TabInactive = Color3.fromRGB(50, 60, 50),
    Accent = Color3.fromRGB(76, 175, 80),
    AccentDim = Color3.fromRGB(56, 142, 60),
    Text = Color3.fromRGB(240, 245, 240),
    TextDim = Color3.fromRGB(140, 165, 140),
    Divider = Color3.fromRGB(45, 55, 45),
    ToggleOff = Color3.fromRGB(55, 55, 55),
}

local UIWidth = IsMobile and 300 or 360
local UIHeight = IsMobile and 460 or 540
local HeaderHeight = IsMobile and 48 or 56
local TabBarHeight = IsMobile and 34 or 40

local MainFrame = Instance.new("Frame")
MainFrame.Name = "Main"
MainFrame.Size = UDim2.new(0, UIWidth, 0, UIHeight)
MainFrame.Position = UDim2.new(0, 20, 0.5, -UIHeight / 2)
MainFrame.BackgroundColor3 = Theme.Bg
MainFrame.BackgroundTransparency = 0.02
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Parent = GUI

Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 14)

local MainStroke = Instance.new("UIStroke")
MainStroke.Thickness = 1.5
MainStroke.Color = Theme.Accent
MainStroke.Transparency = 0.5
MainStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
MainStroke.Parent = MainFrame

local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, HeaderHeight)
Header.BackgroundColor3 = Theme.Card
Header.BackgroundTransparency = 0.2
Header.BorderSizePixel = 0
Header.Parent = MainFrame

Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 14)

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1, -80, 1, 0)
TitleLabel.Position = UDim2.new(0, 16, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Garden Horizons"
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = IsMobile and 15 or 18
TitleLabel.TextColor3 = Theme.Accent
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = Header

local UserTag = Instance.new("TextLabel")
UserTag.Size = UDim2.new(0, 80, 0, 16)
UserTag.Position = UDim2.new(1, -90, 0.5, -8)
UserTag.BackgroundTransparency = 1
UserTag.Text = LocalPlayer.Name
UserTag.Font = Enum.Font.Gotham
UserTag.TextSize = IsMobile and 9 or 10
UserTag.TextColor3 = Theme.TextDim
UserTag.TextXAlignment = Enum.TextXAlignment.Right
UserTag.Parent = Header

local MinBtn = Instance.new("TextButton")
MinBtn.Size = UDim2.new(0, 24, 0, 24)
MinBtn.Position = UDim2.new(1, -34, 0.5, -12)
MinBtn.BackgroundColor3 = Theme.TabBg
MinBtn.Text = "—"
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextSize = 12
MinBtn.TextColor3 = Theme.TextDim
MinBtn.AutoButtonColor = false
MinBtn.Parent = Header
Instance.new("UICorner", MinBtn).CornerRadius = UDim.new(0, 6)

local isMinimized = false
local expandedSize = UDim2.new(0, UIWidth, 0, UIHeight)
local minimizedSize = UDim2.new(0, UIWidth, 0, HeaderHeight)

MinBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    MinBtn.Text = isMinimized and "+" or "—"
    TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quint), {
        Size = isMinimized and minimizedSize or expandedSize
    }):Play()
end)

local TabBar = Instance.new("Frame")
TabBar.Size = UDim2.new(1, -16, 0, TabBarHeight)
TabBar.Position = UDim2.new(0, 8, 0, HeaderHeight + 4)
TabBar.BackgroundColor3 = Theme.TabBg
TabBar.BackgroundTransparency = 0.3
TabBar.BorderSizePixel = 0
TabBar.Parent = MainFrame
Instance.new("UICorner", TabBar).CornerRadius = UDim.new(0, 8)

local TabLayout = Instance.new("UIListLayout")
TabLayout.FillDirection = Enum.FillDirection.Horizontal
TabLayout.Padding = UDim.new(0, 2)
TabLayout.SortOrder = Enum.SortOrder.LayoutOrder
TabLayout.Parent = TabBar

Instance.new("UIPadding", TabBar).PaddingLeft = UDim.new(0, 3)

local tabs = {"Farming", "Player", "Visuals", "Misc"}
local tabButtons = {}
local tabPages = {}
local activeTab = "Farming"

local ContentTop = HeaderHeight + TabBarHeight + 10

for i, tabName in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1 / #tabs, -3, 1, -6)
    btn.BackgroundColor3 = i == 1 and Theme.TabActive or Theme.TabInactive
    btn.BackgroundTransparency = i == 1 and 0 or 0.5
    btn.Text = tabName
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = IsMobile and 10 or 11
    btn.TextColor3 = i == 1 and Theme.Bg or Theme.TextDim
    btn.AutoButtonColor = false
    btn.LayoutOrder = i
    btn.Parent = TabBar
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

    local page = Instance.new("ScrollingFrame")
    page.Name = tabName
    page.Size = UDim2.new(1, -16, 1, -(ContentTop + 8))
    page.Position = UDim2.new(0, 8, 0, ContentTop)
    page.BackgroundTransparency = 1
    page.BorderSizePixel = 0
    page.ScrollBarThickness = 3
    page.ScrollBarImageColor3 = Theme.Accent
    page.ScrollBarImageTransparency = 0.4
    page.CanvasSize = UDim2.new(0, 0, 0, 0)
    page.AutomaticCanvasSize = Enum.AutomaticSize.Y
    page.Visible = i == 1
    page.Parent = MainFrame

    local list = Instance.new("UIListLayout")
    list.Padding = UDim.new(0, 5)
    list.SortOrder = Enum.SortOrder.LayoutOrder
    list.Parent = page

    local pad = Instance.new("UIPadding")
    pad.PaddingTop = UDim.new(0, 4)
    pad.PaddingBottom = UDim.new(0, 8)
    pad.Parent = page

    tabButtons[tabName] = btn
    tabPages[tabName] = page
end

local function switchTab(name)
    activeTab = name
    for tName, btn in pairs(tabButtons) do
        local isActive = tName == name
        TweenService:Create(btn, TweenInfo.new(0.2), {
            BackgroundColor3 = isActive and Theme.TabActive or Theme.TabInactive,
            BackgroundTransparency = isActive and 0 or 0.5
        }):Play()
        btn.TextColor3 = isActive and Theme.Bg or Theme.TextDim
        tabPages[tName].Visible = isActive
    end
end

for tName, btn in pairs(tabButtons) do
    btn.MouseButton1Click:Connect(function()
        switchTab(tName)
    end)
end

local function CreateSection(parent, text, order)
    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1, -8, 0, 20)
    lbl.BackgroundTransparency = 1
    lbl.Text = string.upper(text)
    lbl.Font = Enum.Font.GothamBold
    lbl.TextSize = IsMobile and 9 or 10
    lbl.TextColor3 = Theme.AccentDim
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.LayoutOrder = order
    lbl.Parent = parent
    local p = Instance.new("UIPadding")
    p.PaddingLeft = UDim.new(0, 6)
    p.PaddingTop = UDim.new(0, 4)
    p.Parent = lbl
    return lbl
end

local function CreateToggle(parent, text, order, default, callback)
    local container = Instance.new("Frame")
    container.Size = UDim2.new(1, -4, 0, IsMobile and 34 or 38)
    container.BackgroundColor3 = Theme.Card
    container.BackgroundTransparency = 0.15
    container.LayoutOrder = order
    container.Parent = parent
    Instance.new("UICorner", container).CornerRadius = UDim.new(0, 8)

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1, -58, 1, 0)
    lbl.Position = UDim2.new(0, 12, 0, 0)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.Font = Enum.Font.GothamMedium
    lbl.TextSize = IsMobile and 11 or 12
    lbl.TextColor3 = Theme.Text
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = container

    local toggleBg = Instance.new("Frame")
    toggleBg.Size = UDim2.new(0, 36, 0, 18)
    toggleBg.Position = UDim2.new(1, -48, 0.5, -9)
    toggleBg.BackgroundColor3 = default and Theme.Accent or Theme.ToggleOff
    toggleBg.BorderSizePixel = 0
    toggleBg.Parent = container
    Instance.new("UICorner", toggleBg).CornerRadius = UDim.new(1, 0)

    local knob = Instance.new("Frame")
    knob.Size = UDim2.new(0, 14, 0, 14)
    knob.Position = default and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)
    knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    knob.BorderSizePixel = 0
    knob.Parent = toggleBg
    Instance.new("UICorner", knob).CornerRadius = UDim.new(1, 0)

    local enabled = default
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 1, 0)
    btn.BackgroundTransparency = 1
    btn.Text = ""
    btn.Parent = container

    btn.MouseButton1Click:Connect(function()
        enabled = not enabled
        TweenService:Create(knob, TweenInfo.new(0.2, Enum.EasingStyle.Quint), {
            Position = enabled and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)
        }):Play()
        TweenService:Create(toggleBg, TweenInfo.new(0.2), {
            BackgroundColor3 = enabled and Theme.Accent or Theme.ToggleOff
        }):Play()
        if callback then callback(enabled) end
    end)

    btn.MouseEnter:Connect(function()
        TweenService:Create(container, TweenInfo.new(0.15), {BackgroundTransparency = 0}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(container, TweenInfo.new(0.15), {BackgroundTransparency = 0.15}):Play()
    end)

    return container
end

local function CreateSlider(parent, name, min, max, default, order, callback)
    local container = Instance.new("Frame")
    container.Size = UDim2.new(1, -4, 0, IsMobile and 42 or 46)
    container.BackgroundColor3 = Theme.Card
    container.BackgroundTransparency = 0.15
    container.LayoutOrder = order
    container.Parent = parent
    Instance.new("UICorner", container).CornerRadius = UDim.new(0, 8)

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -60, 0, 16)
    title.Position = UDim2.new(0, 12, 0, 4)
    title.BackgroundTransparency = 1
    title.Text = name
    title.Font = Enum.Font.Gotham
    title.TextSize = IsMobile and 9 or 10
    title.TextColor3 = Theme.TextDim
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = container

    local valLbl = Instance.new("TextLabel")
    valLbl.Size = UDim2.new(0, 44, 0, 16)
    valLbl.Position = UDim2.new(1, -54, 0, 4)
    valLbl.BackgroundTransparency = 1
    valLbl.Text = tostring(default)
    valLbl.Font = Enum.Font.GothamBold
    valLbl.TextSize = IsMobile and 9 or 10
    valLbl.TextColor3 = Theme.Accent
    valLbl.TextXAlignment = Enum.TextXAlignment.Right
    valLbl.Parent = container

    local trackBg = Instance.new("Frame")
    trackBg.Size = UDim2.new(1, -24, 0, 4)
    trackBg.Position = UDim2.new(0, 12, 0, IsMobile and 28 or 30)
    trackBg.BackgroundColor3 = Color3.fromRGB(40, 50, 40)
    trackBg.BorderSizePixel = 0
    trackBg.Parent = container
    Instance.new("UICorner", trackBg).CornerRadius = UDim.new(1, 0)

    local pct = math.clamp((default - min) / (max - min), 0, 1)
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new(pct, 0, 1, 0)
    fill.BackgroundColor3 = Theme.Accent
    fill.BorderSizePixel = 0
    fill.Parent = trackBg
    Instance.new("UICorner", fill).CornerRadius = UDim.new(1, 0)

    local knobFrame = Instance.new("Frame")
    knobFrame.Size = UDim2.new(0, IsMobile and 14 or 12, 0, IsMobile and 14 or 12)
    knobFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    knobFrame.Position = UDim2.new(1, 0, 0.5, 0)
    knobFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    knobFrame.BorderSizePixel = 0
    knobFrame.Parent = fill
    Instance.new("UICorner", knobFrame).CornerRadius = UDim.new(1, 0)

    local hitArea = Instance.new("TextButton")
    hitArea.Size = UDim2.new(1, 10, 2.5, 0)
    hitArea.Position = UDim2.new(0, -5, -0.75, 0)
    hitArea.BackgroundTransparency = 1
    hitArea.Text = ""
    hitArea.Parent = trackBg

    local isDrag = false
    local function update(input)
        local p2 = math.clamp((input.Position.X - trackBg.AbsolutePosition.X) / trackBg.AbsoluteSize.X, 0, 1)
        TweenService:Create(fill, TweenInfo.new(0.05), {Size = UDim2.new(p2, 0, 1, 0)}):Play()
        local v = math.floor(min + (max - min) * p2)
        valLbl.Text = tostring(v)
        if callback then callback(v) end
    end

    hitArea.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDrag = true
            if IsMobile then UserInputService.ModalEnabled = true end
            update(input)
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if isDrag and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            update(input)
        end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and isDrag then
            isDrag = false
            if IsMobile then UserInputService.ModalEnabled = false end
        end
    end)

    return container
end

local function CreateButton(parent, text, order, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -4, 0, IsMobile and 32 or 36)
    btn.BackgroundColor3 = Theme.Card
    btn.BackgroundTransparency = 0.15
    btn.Text = ""
    btn.AutoButtonColor = false
    btn.LayoutOrder = order
    btn.Parent = parent
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1, 0, 1, 0)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.Font = Enum.Font.GothamMedium
    lbl.TextSize = IsMobile and 11 or 12
    lbl.TextColor3 = Theme.Text
    lbl.Parent = btn

    btn.MouseEnter:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Theme.CardHover, BackgroundTransparency = 0}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Theme.Card, BackgroundTransparency = 0.15}):Play()
    end)
    btn.MouseButton1Click:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.08), {BackgroundColor3 = Theme.Accent}):Play()
        task.delay(0.15, function()
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Card}):Play()
        end)
        if callback then callback() end
    end)

    return btn, lbl
end

local function CreateStatusLabel(parent, text, order)
    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1, -8, 0, 18)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.Font = Enum.Font.Gotham
    lbl.TextSize = IsMobile and 9 or 10
    lbl.TextColor3 = Theme.TextDim
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.LayoutOrder = order
    lbl.Parent = parent
    local p = Instance.new("UIPadding")
    p.PaddingLeft = UDim.new(0, 8)
    p.Parent = lbl
    return lbl
end

local farmPage = tabPages["Farming"]

CreateSection(farmPage, "Harvesting", 1)

CreateToggle(farmPage, "Auto Harvest", 2, false, function(s)
    Settings.AutoHarvestEnabled = s
end)

CreateSlider(farmPage, "Harvest Radius", 10, 100, 30, 3, function(v)
    Settings.HarvestRadius = v
    updateRadiusSize()
end)

CreateToggle(farmPage, "Auto Collect (ClickDetectors)", 4, false, function(s)
    Settings.AutoCollectEnabled = s
end)

CreateSection(farmPage, "Seeds", 10)

CreateToggle(farmPage, "Auto TP to Seeds", 11, false, function(s)
    Settings.AutoTPSeedsEnabled = s
end)

CreateSlider(farmPage, "Seed Check Interval (sec)", 1, 10, 3, 12, function(v)
    Settings.SeedCheckInterval = v
end)

local seedStatusLabel = CreateStatusLabel(farmPage, "Seeds: Scanning...", 13)

CreateSection(farmPage, "Gardening", 20)

CreateToggle(farmPage, "Auto Plant", 21, false, function(s)
end)

CreateToggle(farmPage, "Auto Water", 22, false, function(s)
end)

CreateButton(farmPage, "Collect All Nearby", 30, function()
    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end
    for _, desc in pairs(workspace:GetDescendants()) do
        if desc:IsA("ProximityPrompt") and desc.Enabled then
            local p = desc.Parent
            local pos = nil
            if p and p:IsA("BasePart") then pos = p.Position
            elseif p and p:IsA("Model") then
                local pp = p.PrimaryPart or p:FindFirstChildWhichIsA("BasePart")
                if pp then pos = pp.Position end
            end
            if pos and (pos - root.Position).Magnitude <= 60 then
                pcall(function() fireproximityprompt(desc) end)
            end
        end
    end
end)

local playerPage = tabPages["Player"]

CreateSection(playerPage, "Movement", 1)

CreateToggle(playerPage, "Speed Boost", 2, false, function(s)
    Settings.SpeedEnabled = s
    if not s then
        local c = LocalPlayer.Character
        local h = c and c:FindFirstChild("Humanoid")
        if h then h.WalkSpeed = 16 end
    end
end)

CreateSlider(playerPage, "Walk Speed", 16, 150, 32, 3, function(v)
    Settings.SpeedValue = v
end)

CreateToggle(playerPage, "Fly", 4, false, function(s)
    Settings.FlyEnabled = s
end)

CreateSlider(playerPage, "Fly Speed", 10, 250, 50, 5, function(v)
    Settings.FlySpeed = v
end)

CreateSection(playerPage, "Jumping", 10)

CreateToggle(playerPage, "Infinite Jump", 11, false, function(s)
    Settings.InfJumpEnabled = s
end)

CreateSlider(playerPage, "Jump Power", 20, 200, 50, 12, function(v)
    Settings.JumpPower = v
end)

CreateSection(playerPage, "Physics", 20)

CreateToggle(playerPage, "No Clip", 21, false, function(s)
    Settings.NoClipEnabled = s
end)

local visualsPage = tabPages["Visuals"]

CreateSection(visualsPage, "Sky / Lighting", 1)

CreateToggle(visualsPage, "Fullbright", 2, false, function(s)
    Settings.FullbrightEnabled = s
end)

CreateToggle(visualsPage, "Galaxy Sky", 3, false, function(s)
    Settings.GalaxySkyEnabled = s
end)

CreateSection(visualsPage, "Plant Visuals", 10)

CreateToggle(visualsPage, "Plant ESP (Outline)", 11, false, function(s)
    Settings.PlantESPEnabled = s
    if not s and not Settings.PlantChamsEnabled then
        clearTagged("GH_PlantHL")
    end
end)

CreateToggle(visualsPage, "Plant Chams (Filled)", 12, false, function(s)
    Settings.PlantChamsEnabled = s
    if not s and not Settings.PlantESPEnabled then
        clearTagged("GH_PlantHL")
    end
end)

CreateSection(visualsPage, "Player Visuals", 20)

CreateToggle(visualsPage, "Player ESP (Outline)", 21, false, function(s)
    Settings.PlayerESPEnabled = s
    if not s and not Settings.PlayerChamsEnabled then
        clearTagged("GH_PlayerHL")
    end
end)

CreateToggle(visualsPage, "Player Chams (Filled)", 22, false, function(s)
    Settings.PlayerChamsEnabled = s
    if not s and not Settings.PlayerESPEnabled then
        clearTagged("GH_PlayerHL")
    end
end)

local miscPage = tabPages["Misc"]

CreateSection(miscPage, "Utility", 1)

CreateToggle(miscPage, "Anti-AFK", 2, false, function(s)
    Settings.AntiAFKEnabled = s
end)

CreateSection(miscPage, "Teleport", 10)

CreateButton(miscPage, "Teleport to Shop", 11, function()
    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end
    for _, desc in pairs(workspace:GetDescendants()) do
        local n = desc.Name:lower()
        if (n:find("shop") or n:find("store") or n:find("merchant")) then
            local target = nil
            if desc:IsA("BasePart") then
                target = desc
            elseif desc:IsA("Model") then
                target = desc.PrimaryPart or desc:FindFirstChildWhichIsA("BasePart")
            end
            if target then
                root.CFrame = target.CFrame + Vector3.new(0, 5, 0)
                return
            end
        end
    end
end)

CreateButton(miscPage, "Teleport to Seeds", 12, function()
    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end
    for _, desc in pairs(workspace:GetDescendants()) do
        local n = desc.Name:lower()
        if n:find("seed") then
            local target = nil
            if desc:IsA("BasePart") then
                target = desc
            elseif desc:IsA("Model") then
                target = desc.PrimaryPart or desc:FindFirstChildWhichIsA("BasePart")
            end
            if target then
                root.CFrame = target.CFrame + Vector3.new(0, 5, 0)
                return
            end
        end
    end
end)

CreateSection(miscPage, "Server", 20)

CreateButton(miscPage, "Rejoin Server", 21, function()
    game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer)
end)

CreateButton(miscPage, "Server Hop", 22, function()
    local ts = game:GetService("TeleportService")
    local placeId = game.PlaceId
    local servers = game:GetService("HttpService"):JSONDecode(
        game:HttpGet("https://games.roblox.com/v1/games/" .. placeId .. "/servers/Public?sortOrder=Asc&limit=100")
    )
    if servers and servers.data then
        for _, server in pairs(servers.data) do
            if server.id ~= game.JobId and server.playing < server.maxPlayers then
                ts:TeleportToPlaceInstance(placeId, server.id, LocalPlayer)
                return
            end
        end
    end
end)

local dragging, dragInput, dragStart, startPos = false, nil, nil, nil

Header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        if IsMobile then UserInputService.ModalEnabled = true end
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                if IsMobile then UserInputService.ModalEnabled = false end
            end
        end)
    end
end)

Header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        TweenService:Create(MainFrame, TweenInfo.new(0.06), {
            Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        }):Play()
    end
end)

RunService.Heartbeat:Connect(function()
    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")

    if Settings.AutoHarvestEnabled and root then
        local pos = root.Position
        local groundY = pos.Y - 3
        radiusCircle.CFrame = CFrame.new(pos.X, groundY, pos.Z) * CFrame.Angles(0, 0, math.rad(90))
        radiusRing.CFrame = CFrame.new(pos.X, groundY - 0.05, pos.Z) * CFrame.Angles(0, 0, math.rad(90))
    else
        radiusCircle.CFrame = CFrame.new(0, -500, 0)
        radiusRing.CFrame = CFrame.new(0, -500, 0)
    end

    if Settings.SpeedEnabled then
        local hum = char and char:FindFirstChild("Humanoid")
        if hum then hum.WalkSpeed = Settings.SpeedValue end
    end
end)

local flyBV, flyBG = nil, nil

local function startFly()
    local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not root then return end
    flyBV = Instance.new("BodyVelocity")
    flyBV.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    flyBV.Velocity = Vector3.zero
    flyBV.Parent = root
    flyBG = Instance.new("BodyGyro")
    flyBG.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
    flyBG.P = 1e4
    flyBG.Parent = root
end

local function stopFly()
    if flyBV then flyBV:Destroy() flyBV = nil end
    if flyBG then flyBG:Destroy() flyBG = nil end
end

RunService.RenderStepped:Connect(function()
    if not Settings.FlyEnabled then
        if flyBV then stopFly() end
        return
    end
    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end
    if not flyBV or not flyBV.Parent then startFly() end

    local cam = workspace.CurrentCamera
    local dir = Vector3.zero
    if UserInputService:IsKeyDown(Enum.KeyCode.W) then dir = dir + cam.CFrame.LookVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then dir = dir - cam.CFrame.LookVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then dir = dir - cam.CFrame.RightVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then dir = dir + cam.CFrame.RightVector end
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then dir = dir + Vector3.new(0, 1, 0) end
    if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then dir = dir - Vector3.new(0, 1, 0) end

    if IsMobile then
        local hum = char:FindFirstChild("Humanoid")
        if hum and hum.MoveDirection.Magnitude > 0 then
            dir = dir + cam.CFrame.LookVector * hum.MoveDirection.Magnitude
        end
    end

    flyBV.Velocity = (dir.Magnitude > 0 and dir.Unit or Vector3.zero) * Settings.FlySpeed
    flyBG.CFrame = cam.CFrame
end)

UserInputService.JumpRequest:Connect(function()
    if not Settings.InfJumpEnabled then return end
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChild("Humanoid")
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if hum and root then
        hum:ChangeState(Enum.HumanoidStateType.Jumping)
        root.Velocity = Vector3.new(root.Velocity.X, Settings.JumpPower, root.Velocity.Z)
    end
end)

RunService.Stepped:Connect(function()
    if not Settings.NoClipEnabled then return end
    local char = LocalPlayer.Character
    if not char then return end
    for _, part in pairs(char:GetDescendants()) do
        if part:IsA("BasePart") then part.CanCollide = false end
    end
end)

LocalPlayer.Idled:Connect(function()
    if Settings.AntiAFKEnabled then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.zero)
    end
end)

local savedLighting = {
    Brightness = Lighting.Brightness,
    GlobalShadows = Lighting.GlobalShadows,
    FogEnd = Lighting.FogEnd,
    FogStart = Lighting.FogStart,
    FogColor = Lighting.FogColor,
    Ambient = Lighting.Ambient,
    OutdoorAmbient = Lighting.OutdoorAmbient,
    ClockTime = Lighting.ClockTime,
}
local savedSky = nil
local galaxySkyInstance = nil
local galaxyAtmo = nil
local galaxyCC = nil

local function enableGalaxySky()
    for _, child in pairs(Lighting:GetChildren()) do
        if child:IsA("Sky") then
            savedSky = child
            child.Parent = nil
            break
        end
    end

    galaxySkyInstance = Instance.new("Sky")
    galaxySkyInstance.Name = "GH_GalaxySky"
    galaxySkyInstance.StarCount = 5000
    galaxySkyInstance.SkyboxBk = ""
    galaxySkyInstance.SkyboxDn = ""
    galaxySkyInstance.SkyboxFt = ""
    galaxySkyInstance.SkyboxLf = ""
    galaxySkyInstance.SkyboxRt = ""
    galaxySkyInstance.SkyboxUp = ""
    galaxySkyInstance.SunAngularSize = 0
    galaxySkyInstance.MoonAngularSize = 8
    galaxySkyInstance.Parent = Lighting

    galaxyAtmo = Instance.new("Atmosphere")
    galaxyAtmo.Name = "GH_GalaxyAtmo"
    galaxyAtmo.Density = 0.35
    galaxyAtmo.Offset = 0.25
    galaxyAtmo.Color = Color3.fromRGB(25, 10, 50)
    galaxyAtmo.Decay = Color3.fromRGB(40, 20, 80)
    galaxyAtmo.Glare = 0
    galaxyAtmo.Haze = 2
    galaxyAtmo.Parent = Lighting

    galaxyCC = Instance.new("ColorCorrectionEffect")
    galaxyCC.Name = "GH_GalaxyCC"
    galaxyCC.Brightness = 0.05
    galaxyCC.Contrast = 0.15
    galaxyCC.TintColor = Color3.fromRGB(180, 160, 255)
    galaxyCC.Saturation = 0.3
    galaxyCC.Parent = Lighting

    Lighting.ClockTime = 0
    Lighting.Ambient = Color3.fromRGB(20, 15, 40)
    Lighting.OutdoorAmbient = Color3.fromRGB(30, 20, 60)
    Lighting.FogEnd = 1e9
    Lighting.FogColor = Color3.fromRGB(10, 5, 25)
    Lighting.Brightness = 0.3
end

local function disableGalaxySky()
    if galaxySkyInstance then galaxySkyInstance:Destroy() galaxySkyInstance = nil end
    if galaxyAtmo then galaxyAtmo:Destroy() galaxyAtmo = nil end
    if galaxyCC then galaxyCC:Destroy() galaxyCC = nil end
    if savedSky then savedSky.Parent = Lighting savedSky = nil end

    Lighting.Brightness = savedLighting.Brightness
    Lighting.GlobalShadows = savedLighting.GlobalShadows
    Lighting.FogEnd = savedLighting.FogEnd
    Lighting.FogStart = savedLighting.FogStart
    Lighting.FogColor = savedLighting.FogColor
    Lighting.Ambient = savedLighting.Ambient
    Lighting.OutdoorAmbient = savedLighting.OutdoorAmbient
    Lighting.ClockTime = savedLighting.ClockTime
end

local function applyFullbright()
    Lighting.Brightness = 3
    Lighting.GlobalShadows = false
    Lighting.FogEnd = 1e9
    Lighting.Ambient = Color3.fromRGB(200, 200, 200)
    Lighting.OutdoorAmbient = Color3.fromRGB(200, 200, 200)
end

local function removeFullbright()
    if not Settings.GalaxySkyEnabled then
        Lighting.Brightness = savedLighting.Brightness
        Lighting.GlobalShadows = savedLighting.GlobalShadows
        Lighting.FogEnd = savedLighting.FogEnd
        Lighting.Ambient = savedLighting.Ambient
        Lighting.OutdoorAmbient = savedLighting.OutdoorAmbient
    end
end

task.spawn(function()
    local lastGalaxy = false
    local lastFullbright = false
    while true do
        if Settings.GalaxySkyEnabled ~= lastGalaxy then
            if Settings.GalaxySkyEnabled then
                enableGalaxySky()
            else
                disableGalaxySky()
            end
            lastGalaxy = Settings.GalaxySkyEnabled
            if Settings.FullbrightEnabled then applyFullbright() end
        end

        if Settings.FullbrightEnabled ~= lastFullbright then
            if Settings.FullbrightEnabled then
                applyFullbright()
            else
                removeFullbright()
            end
            lastFullbright = Settings.FullbrightEnabled
        end

        task.wait(0.5)
    end
end)

task.spawn(function()
    while true do
        local plantActive = Settings.PlantESPEnabled or Settings.PlantChamsEnabled
        clearTagged("GH_PlantHL")

        if plantActive then
            local char = LocalPlayer.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            if root then
                local seen = {}
                for _, desc in pairs(workspace:GetDescendants()) do
                    if desc:IsA("ProximityPrompt") and desc.Enabled then
                        local target = desc.Parent
                        if target and not seen[target] then
                            seen[target] = true
                            local pos = nil
                            if target:IsA("BasePart") then
                                pos = target.Position
                            elseif target:IsA("Model") then
                                local pp = target.PrimaryPart or target:FindFirstChildWhichIsA("BasePart")
                                if pp then pos = pp.Position end
                            end
                            if pos and (pos - root.Position).Magnitude <= 250 then
                                local existing = target:FindFirstChild("GH_PlantHL")
                                if not existing then
                                    local hl = Instance.new("Highlight")
                                    hl.Name = "GH_PlantHL"
                                    hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop

                                    if Settings.PlantChamsEnabled then
                                        hl.FillColor = Color3.fromRGB(76, 175, 80)
                                        hl.FillTransparency = 0.3
                                    else
                                        hl.FillTransparency = 1
                                    end

                                    if Settings.PlantESPEnabled then
                                        hl.OutlineColor = Color3.fromRGB(129, 199, 132)
                                        hl.OutlineTransparency = 0
                                    else
                                        hl.OutlineTransparency = 1
                                    end

                                    hl.Parent = target
                                end
                            end
                        end
                    end
                end
            end
        end
        task.wait(1.5)
    end
end)

task.spawn(function()
    while true do
        local playerActive = Settings.PlayerESPEnabled or Settings.PlayerChamsEnabled

        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer and plr.Character then
                local existing = plr.Character:FindFirstChild("GH_PlayerHL")
                if playerActive then
                    if not existing then
                        local hl = Instance.new("Highlight")
                        hl.Name = "GH_PlayerHL"
                        hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop

                        if Settings.PlayerChamsEnabled then
                            hl.FillColor = Color3.fromRGB(255, 80, 80)
                            hl.FillTransparency = 0.35
                        else
                            hl.FillTransparency = 1
                        end

                        if Settings.PlayerESPEnabled then
                            hl.OutlineColor = Color3.fromRGB(255, 120, 120)
                            hl.OutlineTransparency = 0
                        else
                            hl.OutlineTransparency = 1
                        end

                        hl.Parent = plr.Character
                    else
                        if Settings.PlayerChamsEnabled then
                            existing.FillColor = Color3.fromRGB(255, 80, 80)
                            existing.FillTransparency = 0.35
                        else
                            existing.FillTransparency = 1
                        end
                        if Settings.PlayerESPEnabled then
                            existing.OutlineColor = Color3.fromRGB(255, 120, 120)
                            existing.OutlineTransparency = 0
                        else
                            existing.OutlineTransparency = 1
                        end
                    end
                else
                    if existing then existing:Destroy() end
                end
            end
        end
        task.wait(1)
    end
end)

local function getPrompts(root, radius)
    local found = {}
    for _, desc in pairs(workspace:GetDescendants()) do
        if desc:IsA("ProximityPrompt") and desc.Enabled then
            local p = desc.Parent
            local pos = nil
            if p and p:IsA("BasePart") then pos = p.Position
            elseif p and p:IsA("Model") then
                local pp = p.PrimaryPart or p:FindFirstChildWhichIsA("BasePart")
                if pp then pos = pp.Position end
            end
            if pos then
                local d = (pos - root.Position).Magnitude
                if d <= radius then
                    table.insert(found, {prompt = desc, distance = d})
                end
            end
        end
    end
    table.sort(found, function(a, b) return a.distance < b.distance end)
    return found
end

task.spawn(function()
    while true do
        if Settings.AutoHarvestEnabled then
            local char = LocalPlayer.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            if root then
                local prompts = getPrompts(root, Settings.HarvestRadius)
                for _, entry in pairs(prompts) do
                    if not Settings.AutoHarvestEnabled then break end
                    pcall(function() fireproximityprompt(entry.prompt) end)
                    task.wait(0.15)
                end
            end
        end
        task.wait(0.3)
    end
end)

task.spawn(function()
    while true do
        if Settings.AutoCollectEnabled then
            local char = LocalPlayer.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            if root then
                for _, desc in pairs(workspace:GetDescendants()) do
                    if desc:IsA("ClickDetector") then
                        local p = desc.Parent
                        if p and p:IsA("BasePart") and (p.Position - root.Position).Magnitude <= Settings.HarvestRadius then
                            pcall(function() fireclickdetector(desc) end)
                        end
                    end
                end
            end
        end
        task.wait(0.5)
    end
end)

local seedState = {}
local seedInitialScanDone = false

local function findSeedLocations()
    local locations = {}
    for _, desc in pairs(workspace:GetDescendants()) do
        local n = desc.Name:lower()
        if n:find("seed") then
            local prompt = nil
            if desc:IsA("Model") then
                prompt = desc:FindFirstChildWhichIsA("ProximityPrompt", true)
            elseif desc:IsA("BasePart") then
                prompt = desc:FindFirstChildWhichIsA("ProximityPrompt")
            end

            local target = nil
            if desc:IsA("BasePart") then
                target = desc
            elseif desc:IsA("Model") then
                target = desc.PrimaryPart or desc:FindFirstChildWhichIsA("BasePart")
            end

            if target then
                table.insert(locations, {
                    name = desc.Name,
                    part = target,
                    prompt = prompt,
                    available = prompt ~= nil and prompt.Enabled,
                    id = desc:GetFullName()
                })
            end
        end
    end
    return locations
end

task.spawn(function()
    while true do
        if Settings.AutoTPSeedsEnabled then
            local seeds = findSeedLocations()
            local char = LocalPlayer.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")

            if #seeds > 0 then
                if not seedInitialScanDone then
                    for _, seed in pairs(seeds) do
                        seedState[seed.id] = seed.available
                    end
                    seedInitialScanDone = true
                    seedStatusLabel.Text = "Seeds: Initial scan done, watching..."
                    seedStatusLabel.TextColor3 = Theme.TextDim
                else
                    local restocked = nil
                    for _, seed in pairs(seeds) do
                        local wasAvailable = seedState[seed.id]
                        if seed.available and not wasAvailable then
                            restocked = seed
                        end
                        seedState[seed.id] = seed.available
                    end

                    if restocked and root then
                        seedStatusLabel.Text = "Seeds: RESTOCKED! TP -> " .. restocked.name
                        seedStatusLabel.TextColor3 = Theme.Accent
                        root.CFrame = restocked.part.CFrame + Vector3.new(0, 5, 0)
                        task.wait(0.5)
                        if restocked.prompt and restocked.prompt.Enabled then
                            pcall(function() fireproximityprompt(restocked.prompt) end)
                        end
                    else
                        seedStatusLabel.Text = "Seeds: Waiting for restock..."
                        seedStatusLabel.TextColor3 = Theme.TextDim
                    end
                end
            else
                seedStatusLabel.Text = "Seeds: No seed locations found"
                seedStatusLabel.TextColor3 = Theme.TextDim
            end
        else
            seedStatusLabel.Text = "Seeds: Disabled"
            seedStatusLabel.TextColor3 = Theme.TextDim
            seedState = {}
            seedInitialScanDone = false
        end
        task.wait(Settings.SeedCheckInterval)
    end
end)

LocalPlayer.CharacterRemoving:Connect(function()
    stopFly()
end)

MainFrame.BackgroundTransparency = 1
MainFrame.Size = UDim2.new(0, UIWidth, 0, 0)
task.wait(0.1)
TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quint), {
    Size = expandedSize,
    BackgroundTransparency = 0.02
}):Play()
